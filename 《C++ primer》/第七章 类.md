&emsp;&emsp;类的基本思想是**数据抽象**和**封装**。数据抽象依赖于**接口**和**实现**分离。**类的接口**包括用户所能执行的操作，**类的实现**包括类的数据成员、负责接口实现的函数体以及定义类所需的各种私有函数。

&emsp;&emsp;封装实现了类的接口和实现的分离。

&emsp;&emsp;类实现数据抽象和封装，需要定义**抽象数据类型**。抽象数据类型指一个数学模型以及定义在该模型上的一组操作。
## 7.1 定义抽象数据类型
#### 7.1.1 设计和定义 Sales_data 类
&emsp;&emsp;执行加法和 IO 的函数不作为 Sales_data 的成员，将其定义为普通函数；执行复合赋值运算的函数是成员函数。Sales_data 的借口应该包含以下操作：

- 一个 isbn 成员函数，返回对象的 ISBN 编号。
- 一个 combine 成员函数，将一个 Sales_data 对象加到另一个对象上。
- 一个 add 函数，执行两个 Sales_data 对象的加法。
- 一个 read 函数，将数据从 istream 读入到 Sales_data 对象中。
- 一个 print 函数，将 Sales_data 对象的值输出到 ostream。

&emsp;&emsp;**成员函数**的声明必须在类的内部，其定义既可以在类的内部也可以在类的外部。**非成员函数**的定义和声明都在外部。定义在类内部的函数是隐式的 inline 函数。
```cpp
class Sales_data{
public:
  string isbn() const {return bookNo;}
  Sales_data& combine(const Sales_data&);   //隐式 inline 函数
  double avg_price() cosnt;                 //售出书籍的平均价格
private:
  string bookNo;
  unsigned units_sold = 0;
  double revenue = 0.0;
};
//非成员函数接口
Sales_data add(const Sales_data&, const Sales_data&);
ostream &print(ostream&, const Sales_data&);
istream &read(istream&, Sales_data&);
```
##### 引入 this
```cpp
Sales_data total;
total.isbn();
```
&emsp;&emsp;成员函数通过 **this** 隐式参数来访问调用它的那个对象。调用一个成员函数时，用请求该函数的对象地址初始化 this。如上，编译器将 total 的地址传递给 isbn 的隐式形参 this。在成员函数内部，**直接使用**调用该函数的对象的成员，this 所指的正是这个对象。

&emsp;&emsp;**任何对类成员的直接访问都被看作 this 的隐式引用**。当 isbn 使用 bookNo 时，它隐式地使用 this 指向的成员(就像this -> bookNo)。

##### 引入 const 成员函数
&emsp;&emsp;默认情况下，this 的类型是指向类类型非常量版本的常量指针。this 遵守初始化规则，不能把 this 绑定到一个常量对象上，不能在一个常量对象上调用普通的成员函数。

&emsp;&emsp;将 const 关键字放在成员函数的参数列表之后，其**表示 this 是一个指向向量的指针**。像这样使用 const 的成员函数称为**常量成员函数**。
```cpp
string isbn() cosnt {return bookNo;}
```
&emsp;&emsp;编译器分两步处理类：首先编译成员的声明，然后在编译成员函数体。**成员函数体可以随意使用类中的其他成员而无须在意这些成员出现的次序**。

##### 在类的外部定义成员函数
&emsp;&emsp;在类的外部定义成员函数时，成员函数的定义必须与它的声明匹配，**类外部定义的成员的名字必须包含其所属的类名**。
```cpp
double Sales_data::avg_price() const {
    if(units_sold)
        return revenue / units_sold;
    else
        return 0;
}
```
##### 定义一个返回 this 对象的函数
```cpp
Sales_data& Sales_data::combine(const Sales_data &rhs){
    units_sold += rhs.units_sold;   //将 rhs 的成员加到 this 对象的成员上
    revenue += rhs.revenue;
    return *this;                   //返回调用该函数的对象
}
```
&emsp;&emsp;调用该函数的对象代表的是赋值运算符左侧的运算对象，右侧运算对象通过显示实参传入函数。假如调用 total.combine(trans)，total 的地址被绑定到隐式的 this 参数上，rhs 绑定到 trans 上，该函数返回 total 的引用。
